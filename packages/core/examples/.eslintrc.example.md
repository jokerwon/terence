# ESLint 配置示例

本文件展示如何在 Core 层使用 ESLint 强制执行架构约束。

## 架构约束规则

Core 层的 `.eslintrc.js` 包含以下规则：

### 1. 禁止引入 React

```javascript
'no-restricted-imports': [
  'error',
  {
    patterns: [
      {
        group: ['react', 'react-dom', 'react/jsx-runtime'],
        message: '[架构约束 Core] Core 层不能引入 React。Adapter 属于 UI 层 (packages/ui/hooks/adapters/)。'
      }
    ]
  }
]
```

**违规示例**:
```javascript
// ❌ 错误：Core 层不能引入 React
import { useState } from 'react'
import { createElement } from 'react'
```

**正确示例**:
```javascript
// ✅ 正确：Core 层导出纯函数和 Engine
export function canSubmit(form) {
  return Boolean(form.account && form.password)
}
```

### 2. 禁止引入状态管理库

```javascript
'no-restricted-imports': [
  'error',
  {
    patterns: [
      {
        group: ['zustand', 'redux', '@reduxjs/toolkit', 'mobx', 'immer'],
        message: '[架构约束 Core] Core 层不能使用状态管理库。Stateless Core 无状态，Engine 使用内部 StateContainer。'
      }
    ]
  }
]
```

**违规示例**:
```javascript
// ❌ 错误：Core 层不能使用 Zustand
import { create } from 'zustand'

// ❌ 错误：Core 层不能使用 Redux
import { useDispatch } from 'react-redux'
```

**正确示例**:
```javascript
// ✅ 正确：Engine 使用内部 StateContainer
import { StateContainer } from '../../utils/StateContainer.js'

const container = new StateContainer(initialState)
```

### 3. 禁止使用 JSX

```javascript
'no-restricted-syntax': [
  'error',
  {
    selector: 'JSXElement',
    message: '[架构约束 Core] Core 层不能使用 JSX。Core 是纯业务逻辑层。'
  }
]
```

**违规示例**:
```javascript
// ❌ 错误：Core 层不能使用 JSX
export function LoginForm() {
  return <form>Login</form>
}
```

**正确示例**:
```javascript
// ✅ 正确：Core 层导出业务逻辑
export { canSubmit, submitLogin } from './login.js'
```

## 测试文件例外

测试文件不受这些规则约束：

```javascript
{
  files: ['**/*.test.js', '**/*.spec.js', 'tests/**/*'],
  rules: {
    'no-restricted-imports': 'off',
    'no-restricted-syntax': 'off',
  }
}
```

## 运行 ESLint

```bash
# 检查所有文件
npm run lint

# 自动修复可修复的问题
npm run lint -- --fix
```

## 常见错误和解决方案

### 错误：Core 层不能引入 React

**问题**: 你在 Core 层尝试使用 React Hook 或 JSX

**解决方案**:
1. 将 UI 组件移到 UI 层 (`packages/ui/`)
2. Core 层只导出纯函数和 Engine
3. 通过 Adapter 连接 Core 和 React

### 错误：Core 层不能使用状态管理库

**问题**: 你在 Core 层尝试使用 Zustand/Redux

**解决方案**:
1. Stateless Core: 使用纯函数，无状态
2. Stateful Engine: 使用内部 StateContainer
3. 页面状态由项目层的 Zustand 管理

### 错误：Core 层不能使用 JSX

**问题**: 你在 Core 层编写了 JSX 代码

**解决方案**:
1. 将 JSX 组件移到 UI 层
2. Core 层只返回数据对象
3. 通过 Adapter 将状态转换为 UI

## 验证架构合规性

使用以下命令验证：

```bash
# 运行 ESLint
npm run lint

# 检查是否有 React 引入
grep -r "from 'react'" src/

# 检查是否有状态管理库
grep -r "from 'zustand'" src/
grep -r "from 'redux'" src/
```
